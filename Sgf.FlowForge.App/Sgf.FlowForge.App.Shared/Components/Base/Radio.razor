@typeparam TValue

<label class="@GetContainerClasses()">
	<input type="radio"
		   class="@GetRadioClasses()"
		   name="@Name"
		   value="@Value"
		   checked="@IsChecked"
		   disabled="@Disabled"
		   @onchange="HandleChange"
		   @attributes="AdditionalAttributes" />

	@if (!string.IsNullOrEmpty(Label) || ChildContent != null)
	{
		<span class="text-xs text-[var(--color-text-primary)] select-none">
			@if (ChildContent != null)
			{
				@ChildContent
			}
			else
			{
				@Label
			}
		</span>
	}
</label>

@code {
	[Parameter] public string Name { get; set; } = string.Empty;
	[Parameter] public TValue? Value { get; set; }
	[Parameter] public TValue? SelectedValue { get; set; }
	[Parameter] public EventCallback<TValue> SelectedValueChanged { get; set; }
	[Parameter] public string? Label { get; set; }
	[Parameter] public RenderFragment? ChildContent { get; set; }
	[Parameter] public bool Disabled { get; set; }
	[Parameter] public RadioSize Size { get; set; } = RadioSize.Medium;
	[Parameter(CaptureUnmatchedValues = true)]
	public Dictionary<string, object>? AdditionalAttributes { get; set; }

	private bool IsChecked => EqualityComparer<TValue>.Default.Equals(Value, SelectedValue);

	private async Task HandleChange(ChangeEventArgs e)
	{
		if (!Disabled && Value != null)
		{
			await SelectedValueChanged.InvokeAsync(Value);
		}
	}

	private string GetContainerClasses()
	{
		var classes = new List<string>
		{
			"inline-flex items-center gap-2"
		};

		if (!Disabled)
		{
			classes.Add("cursor-pointer");
		}
		else
		{
			classes.Add("cursor-not-allowed opacity-50");
		}

		return string.Join(" ", classes);
	}

	private string GetRadioClasses()
	{
		var classes = new List<string>
		{
			"rounded-full border-2 transition-all duration-200",
			"cursor-pointer appearance-none flex-shrink-0",
			"checked:bg-[var(--color-primary-500)] checked:border-[var(--color-primary-500)]",
			"checked:shadow-[inset_0_0_0_3px_var(--color-bg-base)]",
			"focus:outline-none focus:ring-2 focus:ring-[var(--color-primary-200)] focus:ring-offset-1"
		};

		// 尺寸
		classes.Add(Size switch
		{
			RadioSize.Small => "w-3.5 h-3.5",
			RadioSize.Medium => "w-4 h-4",
			RadioSize.Large => "w-5 h-5",
			_ => "w-4 h-4"
		});

		if (!Disabled)
		{
			classes.Add("border-[var(--color-border-primary)] hover:border-[var(--color-primary-400)]");
		}
		else
		{
			classes.Add("cursor-not-allowed");
		}

		return string.Join(" ", classes);
	}

	public enum RadioSize
	{
		Small,
		Medium,
		Large
	}
}

